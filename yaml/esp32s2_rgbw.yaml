substitutions:
  device_name: "Kitchen Task Light"
  device_id: kitchen_task_light
  button_id: btn_${device_id}
  wifi_name: "kitchentasklight"
  password: "govango!"

esphome:
  name: ${wifi_name}
 
esp32:
  board: esp32-s2-saola-1
  framework:
    type: esp-idf
    version: recommended


wifi:
  fast_connect: on
  ssid: "vango-inside"
  password: $password
  power_save_mode: none

  # Enable fallback hotspot (captive portal) in case wifi connection fails
  ap:
    ap_timeout: 5min
    ssid: "${device_name} hotspot"

#captive_portal:
logger:
api:
ota:


binary_sensor:
  - platform: gpio
    name: "Button ${device_name}"
    id: ${button_id}
    pin: 
      number: GPIO5
      mode:
        input: true
        pullup: true
        #be sure not to enable pullup- shelly must have it built-in
    
    filters:
      - invert:
      - delayed_on: 10ms
    on_click: 
      min_length: 10ms
      max_length: 350ms
      then:
      - if:
          condition:
            - light.is_off: ${device_id}
          then:
            - light.turn_on:
                id: ${device_id}
                brightness: .8
          else:
            - light.turn_off: ${device_id}

    on_press:
      then:
        - if:
            condition:
              light.is_off: ${device_id}
            then:
              - delay: 0.5s
              - while:
                  condition:
                    binary_sensor.is_on: ${button_id}
                  then:
                    - light.dim_relative:
                        id: ${device_id}
                        relative_brightness: 5%
                        transition_length: 0.1s
                    - delay: 0.1s
                    
            else:
              - delay: 0.5s
              - while:
                  condition:
                    and:
                      - binary_sensor.is_on: ${button_id}
                      - light.is_on: ${device_id}
                  then:
                    - light.dim_relative:
                        id: ${device_id}
                        relative_brightness: -5%
                        transition_length: 0.1s
                    - delay: 0.1s
                    

light:
  - platform: rgbw
    id: ${device_id}
    name: ${device_name}
    red: pwm_r
    green: pwm_g
    blue: pwm_b
    white: pwm_w
    effects:
      - random:
      - strobe:
      - flicker:

output:
  - platform: ledc
    pin: GPIO1 # default pin is 12
    frequency: 25000 Hz
    id: pwm_r

  - platform: ledc
    pin: GPIO2
    frequency: 25000 Hz
    id: pwm_g

  - platform: ledc
    pin: GPIO3 # default pin is 14
    frequency: 25000 Hz
    id: pwm_b

  - platform: ledc
    pin: GPIO4 #default pin is 4
    frequency: 25000 Hz
    id: pwm_w